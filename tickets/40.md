# Вопрос 40: Анализ примера алгоритма обработки чертежа, обеспечивающего пополнение базовой размерной сетки за счет обработки его особых точек

Общий алгоритм модификации чертежей представлен
на рисунке ниже. Он может быть условно разделен на 3 этапа.
1. На первом, подготовительном, этапе (блоки 1-4) с помощью графической
системы визуализации осуществляется вывод чертежа на экран дисплея
и запуск подсистемы параметризации и модификации этого чертежа. При
этом, прежде всего, устанавливаются начальные параметры подсистемы и
читается файл описания чертежа с выявлением используемых размерных
обозначений и заданием новых значений параметров для этих размеров.
Кроме того, чтобы определить параметры каждого графического примитива,
входящего в описание файла чертежа, на начальном этапе работы подсистемы
необходимо:
	- выявить всю совокупность базовых графических примитивов, определяющих
форму изображенного объекта, и всех сопутствующих им элементов
и разделить их на отдельные группы (основные, вспомогательные и макросы),
а внутри каждой группы выделить типы (например, размеры нужно разделить
на линейные, угловые, радиальные и диаметральные). Далее элементы
соответствующего типа должны быть сгруппированы по видам представления
(например, линейные размеры целесообразно разделить на вертикальные,
горизонтальные, наклонные и под углом, указав для каждого из них, где располагается
размерное число - на размерной линии или на выносной полочке,
и пометить среди них симметричные размеры). Подразделять все элементы на 
однотипные подгруппы целесообразно, так как это позволяет упростить
алгоритмы обработки параметров элементов таких подгрупп.
Во время такого анализа все основные элементы, составляющие форму
объекта, определяются на основании требований ЕСКД, 

![Общий алгоритм параметризации и модификации чертежей](../resources/imgs/40/1.png)

в соответствии с которыми они должны быть выполнены сплошными линиями основной толщины
(им соответствуют определенные атрибуты видимости). Их разделяют на
стандартные графические примитивы - отрезки, линии контуров, окружности,
дуги окружностей, полилинии и блоки. Можно также учитывать и другие
базовые примитивы, если они используются в чертеже. При этом такие
составные примитивы, как полилинии и блоки, расчленяют на составляющие
их базовые графические примитивы — отрезки, дуги, окружности и т. п.,
	- создать соответствующие элементы базовых координатных сеток (по
осям X, Y), выявив координаты X_j и Yj_ характерных точек (начала, конца, центра,
а также квадрантных точек дуг и окружностей) каждого элемента, определяющего
форму объекта, а также элементы угловой сетки (Alf_k). Эта угловая
сетка создается на основании анализа наклона отрезков и углового расположения
точек начала и конца всех дуг
	- формировать, параллельно с анализом геометрических параметров
графических элементов чертежа, данные по прямоугольникам, охватывающим
области, соответствующие отдельным видам детали, представленным на
чертеже. На основе сформированных охватывающих прямоугольников определяются
количество, тип и имена видов, имеющихся на чертеже, и устанавливаются
количественные параметры связей между всеми определенными
видами и элементами базовых сеток, относящихся к этим видам;
	- начать формировать размерные сетки чертежа, например WX, WY и
WA, выявив простые линейные (симметричные и несимметричные горизонтальные
и вертикальные), а также радиальные, диаметральные и угловые
размерные обозначения. При этом следует учесть также значения расстояний
между видами. Каждая такая сетка формируется в виде набора определенного
типа записей, например для элементов X_j и X_к сетки WX в форме (X_i, X_k,
VV_k). В этой записи устанавливается количественное соотношение между
координатами базовых точек примитивов чертежа (X_i, X_k) и новым численным
(или функциональным) значением связывающего их параметра VV_ik,
соответствующего требованиям модификации или расстоянию между выявленными
видами;
	- определить одновременно с созданием размерных сеток по WX, WY и
WA базовую точку чертежа, на основании значений координат которой
должны рассчитываться новые связи между всеми элементами базовых
опорных сеток. За базовую точку принимается та, которая связана с главным
видом и является либо точкой центральной симметрии этого вида, либо лежит
на оси его симметрии, либо с ней связано наибольшее количество радиальных,
диаметральных и линейных размеров, параллельных осям координат.
Другие элементы сетки считаются определенными, если они непосредственно
или опосредованно связаны с базовой точкой через значения этих размерных 
обозначений или расстояниями между видами. Если размерные сетки
полностью охватывают базовую сетку чертежа, то в этом случае можно определить
новое значение каждого элемента базовой сетки через новые значения
размерных обозначений, используемых в чертеже, и перестроить все
компоненты базовой сетки. После этого переходят к модификации элементов
чертежа (блок 14).
В соответствии с новыми значениями элементов базовой сетки программными
средствами блока 14 определяются параметры каждого графического
примитива и осуществляется их перерисовка, т. е. последовательная
модификация всех элементов чертежа. При этом базовая точка преобразованиям
не подвергается (ее исходные координаты не меняются).
На первом этапе, как уже указывалось, фиксируются простые связи, т. е.
определяются связи между теми элементами ортогональных сеток, с которыми
непосредственно связаны горизонтальные, вертикальные, диаметральные
и радиальные размерные обозначения. Одновременно обрабатываются и те
элементы сеток, которые определяются дугами и окружностями с такими же
радиусами и диаметрами, но расположены в других местах чертежа, несмотря
на то, что на них не установлены размерные обозначения.
Следует отметить, что в процессе работы всего алгоритма создания параметрической
модели при определении значения связи между любыми элементами
сетки, связанными с любым из видов чертежа, эта связь должна автоматически
переноситься на сопряженные виды (например, с вида сбоку на
виды снизу и сверху, и наоборот).
Как правило, после первого этапа в основной сетке остается ряд неопределенных
элементов. Это обусловлено тем, что при создании чертежа часть
примитивов формируется с учетом параллельных и угловых размерных обозначений,
которые непосредственно не определяют связи между элементами
ортогональных сеток. Кроме того, при построении чертежей часто используются
различные условия отношений с ранее построенными графическими
элементами, каждое из которых, как указывалось ранее, приводит к уменьшению
общего количества размеров, необходимых для однозначного задания
формы изображаемой фигуры. К таким отношениям между графическими
элементами относятся, как известно, отношения принадлежности, параллельности,
касания, симметрии различного типа, перпендикулярности, постоянства
толщины или расстояния, а также отношения между основной частью
изображения и выноской, отношения типа фаска, развертка и т. д. Поэтому,	
если после первого этапа опорная сетка оказывается не до конца определенной,
ее необходимо доопределить на следующем этапе.

2. На втором этапе (блоки 5-13) связи между элементами сеток должны
определяться в циклическом режиме. Это обусловлено тем, что порядок определения
параметров сеток сильно зависит от структуры и порядка построения
изображения и используемых в нем размерных обозначений. Поэтому
определить некоторые элементы сеток можно только после предварительного 
определения других, и в таких случаях приходится возвращаться на начало
второго этапа.
Начало второго этапа определения элементов ортогональных сеток связано
с обработкой параллельных (одиночных, сдвоенных и строенных) размерных
обозначений.
Одновременно осуществляется доопределение ортогональных сеток и
определение элементов угловой сетки за счет обработки угловых размерных
обозначений. Угловые размеры, кроме угловой составляющей базовой сетки,
связаны еще с двумя составляющими — горизонтальной или вертикальной,
поэтому при их обработке необходимо учитывать значения ранее установленных
связей в одной из этих ортогональных сеток.
Если опорные сетки после выполненных операций все еще определены
не полностью, то для каждого неопределенного элемента сетки выявляются
связанные с ним примитивы изображения. При этом реализуется следующая
последовательность операций:
- определяются графические примитивы, к которым относится эта особая
точка;
- выявляется вид отношения этих примитивов друг с другом в данной
точке (сопряжение, пересечение, перпендикулярность и т.д.);
- на основании соотношений, соответствующих выявленному виду связи,
определяются количественные значения параметров связи для соответствующих
элементов опорной сетки с ранее определенными элементами сетки.
Например, так рассчитывается связь координат точки сопряжения отрезка и
дуги с координатами ее центра на основании известных параметров свободного
конца отрезка и параметров центра и радиуса дуги.
При наличии неопределенных элементов после выполнения второго этапа
возвращаются либо к началу второго, либо переходят к третьему этапу.
Возврат к началу второго этапа осуществляется, если в ходе текущего цикла
работы системой был определен хотя бы один новый элемент какой-либо со115
ставляющей базовой сетки (выявлена его связь с другим элементом, и эта
связь занесена в размерную сетку) или выявлена не реализованная в алгоритме
ситуация, и конструктор для ее разрешения ввел новые данные (например,
дополнительное размерное обозначение или какое-нибудь ограничение).
Таким образом, второй этап завершается либо полным определением сеток
чертежа (завершением полного построения параметрической модели),
либо выходом из неразрешимой ситуации в случае невозможности выявления
за весь цикл ни одного нового элемента в любой сетке.

3. На третьем, завершающем, этапе (блоки 14-16) осуществляется модификация
изображения в соответствии с набором новых значений размерных
обозначений. После перерисовки образа детали осуществляется обработка
элементов оформления чертежа (осей симметрии, размерных и технологических
обозначений и других макросов).
Параметризация (установление связей между всеми параметрами исходных
и модифицированных сеток) по представленному алгоритму, как указывалось
ранее, может быть реализована в функциональном или в численном
виде. При первом созданную модель необходимо сохранять в отдельном
файле, и тогда ее можно использовать многократно для получения модифицированных
чертежей. При втором варианте модель формируется каждый раз
для конкретного набора значений размеров, вводимых пользователем перед
модификацией (анализировать файл чертежа приходится каждый раз заново).